{% extends "base.html" %}

{% block title %}Forecast & Restock â€“ EasyStock{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='forecast.css') }}">
{% endblock %}

{% block content %}
    <div class="dashboard-header">
        <div class="header-text">
            <h1>Forecast & Restock Plan</h1>
            <p class="subtitle">Generate demand predictions and optimize your orders.</p>
        </div>
    </div>

    <div class="forecast-grid">

        <div class="card-section parameters-card">
            <div class="card-header">
                <h3>Parameters</h3>
            </div>

            <form id="forecastForm">
                <div class="form-group">
                    <label for="selectProduct">Select Product</label>
                    <div class="select-wrapper">
                        <select id="selectProduct" name="product_id" required>
                            <option value="">-- Loading products... --</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="monthsInput">Forecast Horizon</label>
                        <div class="input-with-suffix">
                            <input type="number" id="monthsInput" name="months" value="3" min="1" max="12" required>
                            <span class="suffix">months</span>
                        </div>
                    </div>

                    <div class="form-group half">
                        <label for="reviewDaysInput">Review Period</label>
                        <div class="input-with-suffix">
                            <input type="number" id="reviewDaysInput" name="review_days" value="14" min="1" required>
                            <span class="suffix">days</span>
                        </div>
                    </div>
                </div>

                <button type="submit" id="runForecastBtn" class="btn-primary-large">
                    Run Forecast
                </button>
            </form>
        </div>

        <div class="results-container">

            <div id="loadingSpinner" class="spinner-container" hidden>
                <div class="spinner"></div>
                <p>Analyzing historical data & calculating demand...</p>
            </div>

            <div id="forecastResult" class="card-section result-card" hidden>

                <div class="card-header-flex">
                    <h3>ðŸ“Š Forecast Results</h3>
                    <button id="downloadExcelBtn" class="btn-excel">
                        <img src="/static/imgs/download_icon.png" style="width:20px; display:block;" alt="ðŸ“¥">
                        &nbsp;Download Excel
                    </button>
                </div>

                <div id="forecastSummary" class="summary-highlight"></div>

                <div class="chart-wrapper">
                    <canvas id="forecastChart"></canvas>
                </div>

                <h4 class="table-title">Proposed Restock Schedule</h4>

                <div class="table-wrapper-scroll">
                    <table id="planTable" class="result-table">
                        <thead>
                            <tr>
                                <th>Date to Buy</th>
                                <th>Stock Before</th>
                                <th>Predicted Demand</th>
                                <th>Order Qty</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="initialState" class="placeholder-state">
                <div class="placeholder-icon">ðŸ“ˆ</div>
                <h3>Ready to Forecast</h3>
                <p>Select a product on the left to generate your restock plan.</p>
            </div>

        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='scripts/forecast.js') }}" defer></script>
{% endblock %}